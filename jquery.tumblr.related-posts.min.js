/**
*	Create list of related posts by tag
**/$.fn.relatedPosts=function(e){var t=$.extend({tumblrSite:location.hostname,maxPosts:5,header:"Related posts",headerTag:"h3",titleTag:"h4",showImage:!0,postLength:200,deleteOnEmpty:!0,tags:""},e),n=this,r=t.tags.split(","),i=new Array;r.pop();var s=function(e,t){e.sort(function(e,n){return e[t]-n[t]});for(var n=0;n<e.length-1;n++)e[n][t]==e[n+1][t]&&delete e[n];return e.filter(function(e){return typeof e!="undefined"})},o=function(){i=i.filter(function(e){return e.id!=t.postID});i=s(i,"id");i.sort(function(e,t){return e.id<t.id});for(var e=r.length-1;e>=0;e--)i.sort(function(t,n){return t.tags[e]==r[e]?1:-1});i.reverse();var o=i.length;if(o){$(n).show();$(n).append("<"+t.headerTag+">"+t.header+"</"+t.headerTag+">");$(n).append("<ul />");var u=$(n).find("ul");for(var e=0;e<(o>t.maxPosts?t.maxPosts:o);e++){var a=i[e],f=null,l="",c="",h=a.body!=null?a.body:"",p=a.title!=null?a.title:"";if(h!=null){f=/img.*?src=[\'|\"]+([^'"]+)[\'|\"]+/.exec(h);l="";f!=null&&t.showImage&&(l='<a href="'+a.post_url+'"><img src="'+f[1]+'" alt="'+p+'"></a>');c=h.replace(/<.*?>+/g,"").substr(0,t.postLength);c+="..."}u.append("<li>"+l+"<"+t.titleTag+'><a href="'+a.post_url+'">'+p+"</a></"+t.titleTag+"><p>"+c+' <a href="'+a.post_url+'">Read more</a></p></li>')}}else t.deleteOnEmpty&&$(n).remove()},u=function(e){var t=e.response.posts;for(var n=0;n<t.length;n++)i.push(t[n])};$.ajaxSetup({cache:!1});jQuery.ajaxPrefilter(function(e){e.global=!0});$(document).ajaxStop(function(){o()});for(var a=0;a<r.length;a++)$.ajax({type:"GET",url:"http://api.tumblr.com/v2/blog/"+t.tumblrSite+"/posts",dataType:"jsonp",data:{api_key:t.apiKey,tag:r[a],limit:t.maxPosts},success:function(e){u(e)}})};